<!doctype html><html lang="en">
 <head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <meta content="#3c790a" name="theme-color">
  <title>Storage Standard</title>
  <link href="https://resources.whatwg.org/standard.css" rel="stylesheet">
  <link href="https://resources.whatwg.org/bikeshed.css" rel="stylesheet">
  <link href="https://resources.whatwg.org/logo-storage.svg" rel="icon">
  <meta content="Bikeshed 1.0.0" name="generator">
<style>.highlight .hll { background-color: #ffffcc }
.highlight  { background: #ffffff; }
.highlight .c { color: #708090 } /* Comment */
.highlight .k { color: #990055 } /* Keyword */
.highlight .l { color: #000000 } /* Literal */
.highlight .n { color: #0077aa } /* Name */
.highlight .o { color: #999999 } /* Operator */
.highlight .p { color: #999999 } /* Punctuation */
.highlight .cm { color: #708090 } /* Comment.Multiline */
.highlight .cp { color: #708090 } /* Comment.Preproc */
.highlight .c1 { color: #708090 } /* Comment.Single */
.highlight .cs { color: #708090 } /* Comment.Special */
.highlight .kc { color: #990055 } /* Keyword.Constant */
.highlight .kd { color: #990055 } /* Keyword.Declaration */
.highlight .kn { color: #990055 } /* Keyword.Namespace */
.highlight .kp { color: #990055 } /* Keyword.Pseudo */
.highlight .kr { color: #990055 } /* Keyword.Reserved */
.highlight .kt { color: #990055 } /* Keyword.Type */
.highlight .ld { color: #000000 } /* Literal.Date */
.highlight .m { color: #000000 } /* Literal.Number */
.highlight .s { color: #a67f59 } /* Literal.String */
.highlight .na { color: #0077aa } /* Name.Attribute */
.highlight .nc { color: #0077aa } /* Name.Class */
.highlight .no { color: #0077aa } /* Name.Constant */
.highlight .nd { color: #0077aa } /* Name.Decorator */
.highlight .ni { color: #0077aa } /* Name.Entity */
.highlight .ne { color: #0077aa } /* Name.Exception */
.highlight .nf { color: #0077aa } /* Name.Function */
.highlight .nl { color: #0077aa } /* Name.Label */
.highlight .nn { color: #0077aa } /* Name.Namespace */
.highlight .py { color: #0077aa } /* Name.Property */
.highlight .nt { color: #669900 } /* Name.Tag */
.highlight .nv { color: #0077aa } /* Name.Variable */
.highlight .ow { color: #999999 } /* Operator.Word */
.highlight .mb { color: #000000 } /* Literal.Number.Bin */
.highlight .mf { color: #000000 } /* Literal.Number.Float */
.highlight .mh { color: #000000 } /* Literal.Number.Hex */
.highlight .mi { color: #000000 } /* Literal.Number.Integer */
.highlight .mo { color: #000000 } /* Literal.Number.Oct */
.highlight .sb { color: #a67f59 } /* Literal.String.Backtick */
.highlight .sc { color: #a67f59 } /* Literal.String.Char */
.highlight .sd { color: #a67f59 } /* Literal.String.Doc */
.highlight .s2 { color: #a67f59 } /* Literal.String.Double */
.highlight .se { color: #a67f59 } /* Literal.String.Escape */
.highlight .sh { color: #a67f59 } /* Literal.String.Heredoc */
.highlight .si { color: #a67f59 } /* Literal.String.Interpol */
.highlight .sx { color: #a67f59 } /* Literal.String.Other */
.highlight .sr { color: #a67f59 } /* Literal.String.Regex */
.highlight .s1 { color: #a67f59 } /* Literal.String.Single */
.highlight .ss { color: #a67f59 } /* Literal.String.Symbol */
.highlight .vc { color: #0077aa } /* Name.Variable.Class */
.highlight .vg { color: #0077aa } /* Name.Variable.Global */
.highlight .vi { color: #0077aa } /* Name.Variable.Instance */
.highlight .il { color: #000000 } /* Literal.Number.Integer.Long */
        .highlight { background: hsl(24, 20%, 95%); }
        code.highlight { padding: .1em; border-radius: .3em; }
        pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }
        </style>
 <body class="h-entry status-LS">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://whatwg.org/"> <img alt="WHATWG" height="100" src="https://resources.whatwg.org/logo-storage.svg"> </a> </p>
   <hgroup>
    <h1 class="p-name no-ref" id="title">Storage</h1>
    <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">Living Standard — Last Updated <time class="dt-updated" datetime="2016-04-22">22 April 2016</time></span></h2>
   </hgroup>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>Participate:
     <dd><span><a href="https://github.com/whatwg/storage">GitHub whatwg/storage</a> (<a href="https://github.com/whatwg/storage/issues/new">new issue</a>, <a href="https://github.com/whatwg/storage/issues">open issues</a>)</span>
     <dd><span><a href="https://wiki.whatwg.org/wiki/IRC">IRC: #whatwg on Freenode</a></span>
     <dt>Commits:
     <dd><span><a href="https://github.com/whatwg/storage/commits">GitHub whatwg/storage/commits</a></span>
     <dd><span><a href="https://twitter.com/storagestandard">@storagestandard</a></span>
    </dl>
   </div>
   <div data-fill-with="warning"></div>
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
  <div class="p-summary" data-fill-with="abstract">
   <p>The Storage Standard defines an API for persistent storage and quota estimates, as well as the platform storage architecture.</p>
  </div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#introduction"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li><a href="#terminology"><span class="secno">2</span> <span class="content">Terminology</span></a>
    <li>
     <a href="#infrastructure"><span class="secno">3</span> <span class="content">Infrastructure</span></a>
     <ol class="toc">
      <li><a href="#boxes"><span class="secno">3.1</span> <span class="content">Boxes</span></a>
     </ol>
    <li><a href="#persistence"><span class="secno">4</span> <span class="content">Persistence permission</span></a>
    <li><a href="#usage-and-quota"><span class="secno">5</span> <span class="content">Usage and quota</span></a>
    <li>
     <a href="#ui-guidelines"><span class="secno">6</span> <span class="content">User Interface Guidelines</span></a>
     <ol class="toc">
      <li><a href="#storage-pressure"><span class="secno">6.1</span> <span class="content">Storage Pressure</span></a>
     </ol>
    <li><a href="#api"><span class="secno">7</span> <span class="content">API</span></a>
    <li><a href="#acks"><span class="secno"></span> <span class="content">Acknowledgments</span></a>
    <li><a href="#conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
   </ol>
  </nav>
  <main>
<script async="" src="https://resources.whatwg.org/file-issue.js"></script>
<script defer="" id="head" src="https://resources.whatwg.org/dfn.js"></script>
   <h2 class="heading settled" data-level="1" id="introduction"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#introduction"></a></h2>
   <p>Over the years the web has grown various APIs that can be used for storage, e.g., IndexedDB, <code>localStorage</code>, and <code>showNotification()</code>. The Storage Standard consolidates
these APIs by defining:</p>
   <ul class="brief">
    <li>A box, the primitive these APIs store their data in 
    <li>A way of making that box persistent 
    <li>A way of getting usage and quota estimates for an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#origin">origin</a> 
   </ul>
   <p>Traditionally, as the user runs out of storage space on their device, the data stored with these
APIs gets lost without the user being able to intervene. However, persistent boxes cannot be cleared
without consent by the user. This thus brings data guarantees users have enjoyed on native platforms
to the web. </p>
   <div class="example" id="example-3a7051a8">
    <a class="self-link" href="#example-3a7051a8"></a> 
    <p>A simple way to make storage persistent is through invoking the <code class="idl"><a data-link-type="idl" href="#dom-storagemanager-persist">persist()</a></code> method. It
 simultaneously requests the end user for permission and changes the storage to be persistent once
 granted:</p>
<pre><code class="lang-javascript highlight"><span class="nx">navigator</span><span class="p">.</span><span class="nx">storage</span><span class="p">.</span><span class="nx">persist</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">persisted</span> <span class="o">=></span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">persisted</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/* … */</span>
  <span class="p">}</span>
<span class="p">})</span></code></pre>
    <p>To not show user-agent-driven dialogs to the end user unannounced slightly more involved code
 can be written:</p>
<pre><code class="lang-javascript highlight"><span class="nx">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">([</span>
  <span class="nx">navigator</span><span class="p">.</span><span class="nx">storage</span><span class="p">.</span><span class="nx">persisted</span><span class="p">(),</span>
  <span class="nx">navigator</span><span class="p">.</span><span class="nx">permissions</span><span class="p">.</span><span class="nx">query</span><span class="p">({</span><span class="nx">name</span><span class="o">:</span> <span class="s2">"persistent-storage"</span><span class="p">})</span>
<span class="p">]).</span><span class="nx">then</span><span class="p">((</span><span class="nx">persisted</span><span class="p">,</span> <span class="nx">permission</span><span class="p">)</span> <span class="o">=></span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">persisted</span> <span class="o">&amp;&amp;</span> <span class="nx">permission</span> <span class="o">==</span> <span class="s2">"granted"</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">navigator</span><span class="p">.</span><span class="nx">storage</span><span class="p">.</span><span class="nx">persist</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span> <span class="cm">/* … */</span> <span class="p">)</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">persistent</span> <span class="o">&amp;&amp;</span> <span class="nx">permission</span> <span class="o">==</span> <span class="s2">"default"</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">showPersistentStorageExplanation</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">})</span></code></pre>
    <p>The <code class="idl"><a data-link-type="idl" href="#dom-storagemanager-estimate">estimate()</a></code> method can be used to determine whether there is enough space left to
 download another Metriod Prime level: </p>
<pre><code class="lang-javascript highlight"><span class="nx">navigator</span><span class="p">.</span><span class="nx">storage</span><span class="p">.</span><span class="nx">estimate</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">info</span> <span class="o">=></span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">info</span><span class="p">.</span><span class="nx">quota</span> <span class="o">-</span> <span class="nx">info</span><span class="p">.</span><span class="nx">usage</span> <span class="o">></span> <span class="nx">metroidPrimeLevel</span><span class="p">.</span><span class="nx">size</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">metroidPrimeLevel</span><span class="p">.</span><span class="nx">url</span><span class="p">)</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">"no space"</span><span class="p">)</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span> <span class="cm">/* … */</span> <span class="p">)</span></code></pre>
   </div>
   <h2 class="heading settled" data-level="2" id="terminology"><span class="secno">2. </span><span class="content">Terminology</span><a class="self-link" href="#terminology"></a></h2>
   <p>This specification uses terminology from the DOM and HTML Standards. <a data-link-type="biblio" href="#biblio-dom">[DOM]</a> <a data-link-type="biblio" href="#biblio-html">[HTML]</a></p>
   <p>A <dfn data-dfn-type="dfn" data-noexport="" id="site">site<a class="self-link" href="#site"></a></dfn> is eTLD+1. <span class="XXX">Needs a more formal definition.</span></p>
   <h2 class="heading settled" data-level="3" id="infrastructure"><span class="secno">3. </span><span class="content">Infrastructure</span><a class="self-link" href="#infrastructure"></a></h2>
   <p>A user agent has various kinds of storage:</p>
   <dl>
    <dt>Network 
    <dd>
     <p>HTTP cache, cookies, authentication entries, TLS client certificates </p>
    <dt>Credentials 
    <dd>
     <p>End-user credentials, such as username and passwords submitted through HTML forms </p>
    <dt>Permissions 
    <dd>
     <p>Permissions for various features, such as geolocation </p>
    <dt>Site 
    <dd>Indexed DB, Cache API, service worker registrations, <code>localStorage</code>, <code>history.pushState()</code> 
   </dl>
   <p>This specification primarily concerns itself with <dfn data-dfn-type="dfn" data-export="" id="site-storage">site storage<a class="self-link" href="#site-storage"></a></dfn>.</p>
   <p><a data-link-type="dfn" href="#site-storage">Site storage</a> consists of zero or more <dfn data-dfn-type="dfn" data-export="" id="site-storage-unit">site storage units<a class="self-link" href="#site-storage-unit"></a></dfn>.</p>
   <p>Each <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#origin">origin</a> has an associated <a data-link-type="dfn" href="#site-storage-unit">site storage unit</a>. A <a data-link-type="dfn" href="#site-storage-unit">site storage unit</a> contains
a single <dfn data-dfn-type="dfn" data-export="" id="box">box<a class="self-link" href="#box"></a></dfn>. <a data-link-type="biblio" href="#biblio-html">[HTML]</a></p>
   <h3 class="heading settled" data-level="3.1" id="boxes"><span class="secno">3.1. </span><span class="content">Boxes</span><a class="self-link" href="#boxes"></a></h3>
   <p>A <a data-link-type="dfn" href="#box">box</a> has <dfn data-dfn-for="box" data-dfn-type="dfn" data-export="" id="box-mode">mode<a class="self-link" href="#box-mode"></a></dfn> which is either "<code title="">best-effort</code>" or
"<code title="">persistent</code>". A <dfn data-dfn-type="dfn" data-export="" id="persistent-box">persistent box<a class="self-link" href="#persistent-box"></a></dfn> is a <a data-link-type="dfn" href="#box">box</a> whose <a data-link-type="dfn" href="#box-mode">mode</a> is "<code title="">persistent</code>". A <dfn data-dfn-type="dfn" data-export="" id="non-persistent-box">non-persistent box<a class="self-link" href="#non-persistent-box"></a></dfn> is a <a data-link-type="dfn" href="#box">box</a> whose <a data-link-type="dfn" href="#box-mode">mode</a> is <em>not</em> "<code title="">persistent</code>".</p>
   <p>A box is considered to be an atomic unit. Whenever a <a data-link-type="dfn" href="#box">box</a> is cleared by the user agent, it
must be cleared in its entirety.</p>
   <h2 class="heading settled" data-level="4" id="persistence"><span class="secno">4. </span><span class="content">Persistence permission</span><a class="self-link" href="#persistence"></a></h2>
   <p>A <a data-link-type="dfn" href="#box">box</a> can only be turned into a <a data-link-type="dfn" href="#persistent-box">persistent box</a> if the user (or user agent
on behalf of the user) has granted <dfn data-dfn-type="dfn" data-noexport="" id="permission">permission<a class="self-link" href="#permission"></a></dfn>.</p>
   <p class="XXX">We will eventually integrate with the Permissions API, with the identifier
"<code>persistent-storage</code>", but since that specification is not in great shape at the moment
that has not happened yet. </p>
   <h2 class="heading settled" data-level="5" id="usage-and-quota"><span class="secno">5. </span><span class="content">Usage and quota</span><a class="self-link" href="#usage-and-quota"></a></h2>
   <p>The <dfn data-dfn-type="dfn" data-export="" id="site-storage-usage">site storage usage<a class="self-link" href="#site-storage-usage"></a></dfn> of an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#origin">origin</a> <var>origin</var> is a rough estimate
of the amount of bytes used in <var>origin</var>’s <a data-link-type="dfn" href="#site-storage-unit">site storage unit</a>.</p>
   <p class="note" role="note">This cannot be an exact amount as user agents might, and are encouraged to, use
deduplication, compression, and other techniques that obscure exactly how much bytes an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#origin">origin</a> uses. </p>
   <p>The <dfn data-dfn-type="dfn" data-export="" id="site-storage-quota">site storage quota<a class="self-link" href="#site-storage-quota"></a></dfn> of an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#origin">origin</a> <var>origin</var> is a conserviate
estimate of the amount of bytes available to <var>origin</var>’s <a data-link-type="dfn" href="#site-storage-unit">site storage unit</a>. This
amount should be less than the total available storage space on the device to give users some wiggle
room.</p>
   <p class="note" role="note">User agents are strongly encouraged to provide "popular" <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#origin">origins</a> with a larger <a data-link-type="dfn" href="#site-storage-quota">site storage quota</a>. Factors such as navigation frequency, recency of visits, bookmarking,
and <a data-link-type="dfn" href="#permission">permission</a> for "<code>persistent-storage</code>" can be used as indications of
"popularity". </p>
   <h2 class="heading settled" data-level="6" id="ui-guidelines"><span class="secno">6. </span><span class="content">User Interface Guidelines</span><a class="self-link" href="#ui-guidelines"></a></h2>
   <p>User agents should not distinguish between network storage and <a data-link-type="dfn" href="#site-storage">site storage</a> in their user
interface. Instead user agents should offer users the ability to remove all storage for a given <a data-link-type="dfn" href="#site">site</a>. This ensures that storage from one source cannot be used to revive storage from another
source. This also helps users avoid having to know about the different ways in which <a data-link-type="dfn" href="#site">sites</a> can store data.</p>
   <p class="XXX">This is still a concern due to HTTP ETag... </p>
   <p>Credentials storage should still be separated however as it might contain data the user might not be
able to revive, such as an autogenerated password.</p>
   <h3 class="heading settled" data-level="6.1" id="storage-pressure"><span class="secno">6.1. </span><span class="content">Storage Pressure</span><a class="self-link" href="#storage-pressure"></a></h3>
   <p>When the user agent notices it comes under storage pressure and it cannot free up sufficient space
by clearing network storage and <a data-link-type="dfn" href="#non-persistent-box">non-persistent boxes</a> within <a data-link-type="dfn" href="#site-storage">site storage</a>, then the
user agent should alert the user and offer a way to clear <a data-link-type="dfn" href="#persistent-box">persistent boxes</a>.</p>
   <h2 class="heading settled" data-level="7" id="api"><span class="secno">7. </span><span class="content">API</span><a class="self-link" href="#api"></a></h2>
<pre class="idl def">[SecureContext,
 NoInterfaceObject,
 Exposed=(Window,Worker)]
interface <dfn class="idl-code" data-dfn-type="interface" data-export="" id="navigatorstorage">NavigatorStorage<a class="self-link" href="#navigatorstorage"></a></dfn> {
  readonly attribute <a data-link-type="idl-name" href="#storagemanager">StorageManager</a> <a class="idl-code" data-link-type="attribute" data-readonly="" data-type="StorageManager " href="#dom-navigatorstorage-storage">storage</a>;
};
<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#navigator">Navigator</a> implements <a data-link-type="idl-name" href="#navigatorstorage">NavigatorStorage</a>;
<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/workers.html#workernavigator">WorkerNavigator</a> implements <a data-link-type="idl-name" href="#navigatorstorage">NavigatorStorage</a>;
</pre>
   <p>Each <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object">environment settings object</a> has an associated <code class="idl"><a data-link-type="idl" href="#storagemanager">StorageManager</a></code> object. <a data-link-type="biblio" href="#biblio-html">[HTML]</a></p>
   <p>The <dfn class="idl-code" data-dfn-for="NavigatorStorage" data-dfn-type="attribute" data-export="" id="dom-navigatorstorage-storage"><code>storage</code><a class="self-link" href="#dom-navigatorstorage-storage"></a></dfn> attribute’s getter must return <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object">context object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object">relevant settings object</a>’s <code class="idl"><a data-link-type="idl" href="#storagemanager">StorageManager</a></code> object.</p>
<pre class="idl def">[SecureContext,
 Exposed=(Window,Worker)]
interface <dfn class="idl-code" data-dfn-type="interface" data-export="" id="storagemanager">StorageManager<a class="self-link" href="#storagemanager"></a></dfn> {
  Promise&lt;boolean> <a class="idl-code" data-link-type="method" href="#dom-storagemanager-persisted">persisted</a>();
  [Exposed=Window] Promise&lt;boolean> <a class="idl-code" data-link-type="method" href="#dom-storagemanager-persist">persist</a>();

  Promise&lt;<a data-link-type="idl-name" href="#dictdef-storageestimate">StorageEstimate</a>> <a class="idl-code" data-link-type="method" href="#dom-storagemanager-estimate">estimate</a>();
};

dictionary <dfn class="idl-code" data-dfn-type="dictionary" data-export="" id="dictdef-storageestimate">StorageEstimate<a class="self-link" href="#dictdef-storageestimate"></a></dfn> {
  unsigned long long <dfn class="idl-code" data-dfn-for="StorageEstimate" data-dfn-type="dict-member" data-export="" data-type="unsigned long long " id="dom-storageestimate-usage">usage<a class="self-link" href="#dom-storageestimate-usage"></a></dfn>;
  unsigned long long <dfn class="idl-code" data-dfn-for="StorageEstimate" data-dfn-type="dict-member" data-export="" data-type="unsigned long long " id="dom-storageestimate-quota">quota<a class="self-link" href="#dom-storageestimate-quota"></a></dfn>;
};
</pre>
   <p>The <dfn class="idl-code" data-dfn-for="StorageManager" data-dfn-type="method" data-export="" id="dom-storagemanager-persisted"><code>persisted()</code><a class="self-link" href="#dom-storagemanager-persisted"></a></dfn> method, when invoked, must run
these steps:</p>
   <ol>
    <li>
     <p>Let <var>promise</var> be a new promise. </p>
    <li>
     <p>Let <var>settingsObject</var> be <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object">context object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object">relevant settings object</a>. </p>
    <li>
     <p>Run these substeps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel">in parallel</a>: <a data-link-type="biblio" href="#biblio-html">[HTML]</a> </p>
     <ol>
      <li>
       <p>Let <var>origin</var> be <var>settingsObject</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#origin">origin</a>. </p>
      <li>
       <p>Let <var>persisted</var> be true if <var>origin</var>’s <a data-link-type="dfn" href="#site-storage-unit">site storage unit</a>’s <a data-link-type="dfn" href="#box">box</a> is a <a data-link-type="dfn" href="#persistent-box">persistent box</a>, and false otherwise. </p>
      <li>
       <p>Resolve <var>promise</var> with <var>persisted</var>. </p>
     </ol>
    <li>
     <p>Return <var>promise</var>. </p>
   </ol>
   <p>The <dfn class="idl-code" data-dfn-for="StorageManager" data-dfn-type="method" data-export="" id="dom-storagemanager-persist"><code>persist()</code><a class="self-link" href="#dom-storagemanager-persist"></a></dfn> method, when invoked, must run these
steps:</p>
   <ol>
    <li>
     <p>Let <var>promise</var> be a new promise. </p>
    <li>
     <p>Let <var>settingsObject</var> be <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object">context object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object">relevant settings object</a>. </p>
    <li>
     <p>Run these substeps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel">in parallel</a>: </p>
     <ol>
      <li>
       <p>Let <var>origin</var> be <var>settingsObject</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#origin">origin</a>. </p>
      <li>
       <p>Let <var>permission</var> be <a data-link-type="dfn" href="#permission">permission</a> for <var>origin</var>. </p>
      <li>
       <p>If <var>permission</var> is "<code title="">prompt</code>", then ask the user whether
   turning <var>origin</var>’s <a data-link-type="dfn" href="#site-storage-unit">site storage unit</a>’s <a data-link-type="dfn" href="#box">box</a> into a <a data-link-type="dfn" href="#persistent-box">persistent box</a> is
   acceptable. If it is, then set <var>permission</var> to "<code title="">granted</code>", and
   "<code title="">denied</code>" otherwise. </p>
      <li>
       <p>Let <var>persisted</var> be true if <var>origin</var>’s <a data-link-type="dfn" href="#site-storage-unit">site storage unit</a>’s <a data-link-type="dfn" href="#box">box</a> is a <a data-link-type="dfn" href="#persistent-box">persistent box</a>, and false otherwise. </p>
      <li>
       <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task">Queue a task</a> to run these subsubsteps: </p>
       <ol>
        <li>
         <p>Set <a data-link-type="dfn" href="#permission">permission</a> for <var>origin</var> to <var>permission</var>. </p>
        <li>
         <p>If <var>persisted</var> is false and <var>permission</var> is "<code>granted</code>",
     set <var>persisted</var> to true and set <var>origin</var>’s <a data-link-type="dfn" href="#site-storage-unit">site storage unit</a>’s <a data-link-type="dfn" href="#box">box</a>’s <a data-link-type="dfn" href="#box-mode">mode</a> to "<code>persistent</code>". </p>
        <li>
         <p>Resolve <var>promise</var> with <var>persisted</var>. </p>
       </ol>
     </ol>
    <li>
     <p>Return <var>promise</var>. </p>
   </ol>
   <p>The <dfn class="idl-code" data-dfn-for="StorageManager" data-dfn-type="method" data-export="" id="dom-storagemanager-estimate"><code>estimate()</code><a class="self-link" href="#dom-storagemanager-estimate"></a></dfn> method, when invoked,
must run these steps:</p>
   <ol>
    <li>
     <p>Let <var>promise</var> be a new promise. </p>
    <li>
     <p>Let <var>settingsObject</var> be <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#context-object">context object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object">relevant settings object</a>. </p>
    <li>
     <p>Run these substeps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel">in parallel</a>: </p>
     <ol>
      <li>
       <p>Let <var>origin</var> be <var>settingsObject</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#origin">origin</a>. </p>
      <li>
       <p>Let <var>usage</var> be <a data-link-type="dfn" href="#site-storage-usage">site storage usage</a> for <var>origin</var>. </p>
      <li>
       <p>Let <var>quota</var> be <a data-link-type="dfn" href="#site-storage-quota">site storage quota</a> for <var>origin</var>. </p>
      <li>
       <p>Let <var>dictionary</var> be a new <code class="idl"><a data-link-type="idl" href="#dictdef-storageestimate">StorageEstimate</a></code> dictionary whose <code class="idl"><a data-link-type="idl" href="#dom-storageestimate-usage">usage</a></code> member
   is <var>usage</var> and <code class="idl"><a data-link-type="idl" href="#dom-storageestimate-quota">quota</a></code> member is <var>quota</var>. </p>
      <li>
       <p>Resolve <var>promise</var> with <var>dictionary</var>. </p>
     </ol>
    <li>
     <p>Return <var>promise</var>. </p>
   </ol>
   <h2 class="no-num heading settled" id="acks"><span class="content">Acknowledgments</span><a class="self-link" href="#acks"></a></h2>
   <p>With that, many thanks to
Adrian Bateman,
Alex Russell,
Aislinn Grigas,
Ali Alabbas,
Ben Kelly,
Ben Turner,
David Grogan,
Jake Archibald,
Jonas Sicking,
Joshua Bell,
Kenji Baheux,
Kinuko Yasuda,
Luke Wagner,
Mounir Lamouri, and
Shachar Zohar
for being awesome!</p>
   <p>This standard is written by <a href="https://annevankesteren.nl/" lang="nl">Anne van Kesteren</a> (<a href="https://www.mozilla.org/">Mozilla</a>, <a href="mailto:annevk@annevk.nl">annevk@annevk.nl</a>).</p>
   <p>Per <a href="https://creativecommons.org/publicdomain/zero/1.0/" rel="license">CC0</a>, to the
extent possible under law, the editor has waived all copyright and related or neighboring
rights to this work.</p>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-num no-ref heading settled" id="conformance"><span class="content">Conformance</span><a class="self-link" href="#conformance"></a></h2>
   <p>All diagrams, examples, and notes in this specification are non-normative, as are all sections explicitly marked non-normative. Everything else in this specification is normative. </p>
   <p>The key words “MUST”, “MUST NOT”, “REQUIRED”,  “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL” in the normative parts of this specification are to be interpreted as described in RFC2119. For readability, these words do not appear in all uppercase letters in this specification. <a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a> </p>
   <p>Conformance requirements phrased as algorithms or specific steps may be implemented in any manner, so long as the end result is equivalent. (In particular, the algorithms defined in this specification are intended to be easy to follow, and not intended to be performant.) </p>
  </div>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#box">box</a><span>, in §3</span>
   <li><a href="#dom-storagemanager-estimate">estimate()</a><span>, in §7</span>
   <li><a href="#box-mode">mode</a><span>, in §3.1</span>
   <li><a href="#navigatorstorage">NavigatorStorage</a><span>, in §7</span>
   <li><a href="#non-persistent-box">non-persistent box</a><span>, in §3.1</span>
   <li><a href="#permission">permission</a><span>, in §4</span>
   <li><a href="#dom-storagemanager-persist">persist()</a><span>, in §7</span>
   <li><a href="#dom-storagemanager-persisted">persisted()</a><span>, in §7</span>
   <li><a href="#persistent-box">persistent box</a><span>, in §3.1</span>
   <li><a href="#dom-storageestimate-quota">quota</a><span>, in §7</span>
   <li><a href="#site">site</a><span>, in §2</span>
   <li><a href="#site-storage">site storage</a><span>, in §3</span>
   <li><a href="#site-storage-quota">site storage quota</a><span>, in §5</span>
   <li><a href="#site-storage-unit">site storage units</a><span>, in §3</span>
   <li><a href="#site-storage-usage">site storage usage</a><span>, in §5</span>
   <li><a href="#dom-navigatorstorage-storage">storage</a><span>, in §7</span>
   <li><a href="#dictdef-storageestimate">StorageEstimate</a><span>, in §7</span>
   <li><a href="#storagemanager">StorageManager</a><span>, in §7</span>
   <li><a href="#dom-storageestimate-usage">usage</a><span>, in §7</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><a href="https://dom.spec.whatwg.org/#context-object">context object</a>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#navigator">Navigator</a>
     <li><a href="https://html.spec.whatwg.org/multipage/workers.html#workernavigator">WorkerNavigator</a>
     <li><a href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel">in parallel</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task">queue a task</a>
     <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object">relevant settings object</a>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/">DOM Standard</a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-html">[HTML]
   <dd>Ian Hickson. <a href="https://html.spec.whatwg.org/multipage/">HTML Standard</a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>. March 1997. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc2119">https://tools.ietf.org/html/rfc2119</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl def">[SecureContext,
 NoInterfaceObject,
 Exposed=(Window,Worker)]
interface <a href="#navigatorstorage">NavigatorStorage</a> {
  readonly attribute <a data-link-type="idl-name" href="#storagemanager">StorageManager</a> <a class="idl-code" data-link-type="attribute" data-readonly="" data-type="StorageManager " href="#dom-navigatorstorage-storage">storage</a>;
};
<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#navigator">Navigator</a> implements <a data-link-type="idl-name" href="#navigatorstorage">NavigatorStorage</a>;
<a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/workers.html#workernavigator">WorkerNavigator</a> implements <a data-link-type="idl-name" href="#navigatorstorage">NavigatorStorage</a>;

[SecureContext,
 Exposed=(Window,Worker)]
interface <a href="#storagemanager">StorageManager</a> {
  Promise&lt;boolean> <a class="idl-code" data-link-type="method" href="#dom-storagemanager-persisted">persisted</a>();
  [Exposed=Window] Promise&lt;boolean> <a class="idl-code" data-link-type="method" href="#dom-storagemanager-persist">persist</a>();

  Promise&lt;<a data-link-type="idl-name" href="#dictdef-storageestimate">StorageEstimate</a>> <a class="idl-code" data-link-type="method" href="#dom-storagemanager-estimate">estimate</a>();
};

dictionary <a href="#dictdef-storageestimate">StorageEstimate</a> {
  unsigned long long <a data-type="unsigned long long " href="#dom-storageestimate-usage">usage</a>;
  unsigned long long <a data-type="unsigned long long " href="#dom-storageestimate-quota">quota</a>;
};

</pre>